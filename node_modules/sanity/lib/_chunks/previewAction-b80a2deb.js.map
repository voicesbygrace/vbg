{"version":3,"file":"previewAction-b80a2deb.js","sources":["../../src/_internal/cli/actions/preview/previewAction.ts"],"sourcesContent":["import path from 'path'\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore The `@sanity/server` may not be built yet.\nimport {PreviewServerOptions, startPreviewServer} from '@sanity/server'\nimport type {CliConfig, CliCommandArguments, CliCommandContext} from '@sanity/cli'\nimport {getSharedServerConfig, gracefulServerDeath} from '../../util/servers'\n\nexport interface StartPreviewServerCommandFlags {\n  host?: string\n  port?: string\n}\n\nexport default async function startSanityPreviewServer(\n  args: CliCommandArguments<StartPreviewServerCommandFlags>,\n  context: CliCommandContext\n): Promise<void> {\n  const flags = args.extOptions\n  const {workDir, cliConfig} = context\n\n  const defaultRootDir = path.resolve(path.join(workDir, 'dist'))\n  const rootDir = path.resolve(args.argsWithoutOptions[0] || defaultRootDir)\n  const config = getPreviewServerConfig({flags, workDir, cliConfig, rootDir})\n\n  try {\n    await startPreviewServer(config)\n  } catch (err) {\n    gracefulServerDeath('preview', config.httpHost, config.httpPort, err)\n  }\n}\n\nfunction getPreviewServerConfig({\n  flags,\n  workDir,\n  cliConfig,\n  rootDir,\n}: {\n  flags: StartPreviewServerCommandFlags\n  rootDir: string\n  workDir: string\n  cliConfig?: CliConfig\n}): PreviewServerOptions {\n  const baseConfig = getSharedServerConfig({flags, workDir, cliConfig})\n  return {\n    ...baseConfig,\n    root: rootDir,\n  }\n}\n"],"names":["startSanityPreviewServer","args","context","flags","extOptions","workDir","cliConfig","defaultRootDir","path","resolve","join","rootDir","argsWithoutOptions","config","getPreviewServerConfig","startPreviewServer","err","gracefulServerDeath","httpHost","httpPort","baseConfig","getSharedServerConfig","root"],"mappings":";;;;;;;;;;;;;;AAY8B,eAAAA,wBAAA,CAC5BC,MACAC,OACe,EAAA;EACf,MAAMC,QAAQF,IAAK,CAAAG,UAAA;EACb,MAAA;IAACC,OAAS;IAAAC;EAAa,CAAA,GAAAJ,OAAA;EAE7B,MAAMK,iBAAiBC,aAAK,CAAA,SAAA,CAAA,CAAAC,OAAA,CAAQD,aAAAA,CAAAA,SAAAA,EAAKE,IAAK,CAAAL,OAAA,EAAS,MAAM,CAAC,CAAA;EAC9D,MAAMM,UAAUH,aAAK,CAAA,SAAA,CAAA,CAAAC,OAAA,CAAQR,IAAK,CAAAW,kBAAA,CAAmB,MAAML,cAAc,CAAA;EACzE,MAAMM,SAASC,sBAAuB,CAAA;IAACX;IAAOE,OAAS;IAAAC,SAAA;IAAWK;GAAQ,CAAA;EAEtE,IAAA;IACF,MAAMI,MAAAA,CAAAA,mBAAmBF,MAAM,CAAA;WACxBG,GAAP,EAAA;IACAC,OAAA,CAAAA,mBAAA,CAAoB,SAAW,EAAAJ,MAAA,CAAOK,QAAU,EAAAL,MAAA,CAAOM,UAAUH,GAAG,CAAA;EACtE;AACF;AAEA,SAASF,sBAAuB,OAUP;EAAA,IAVO;IAC9BX,KAAA;IACAE,OAAA;IACAC,SAAA;IACAK;EACF,CAKyB;EACvB,MAAMS,aAAaC,OAAAA,CAAAA,qBAAsB,CAAA;IAAClB,KAAO;IAAAE,OAAA;IAASC;GAAU,CAAA;EAC7D,uCACFc,UAAA;IACHE,IAAM,EAAAX;EAAA;AAEV;"}